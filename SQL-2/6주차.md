# 6ì£¼ì°¨ ì¢…í•© ì‹¤ì „ ë¬¸ì œ í’€ì´


## ğŸ“Œ ë³µìˆ˜ êµ­ì  ë©”ë‹¬ ìˆ˜ìƒí•œ ì„ ìˆ˜ ì°¾ê¸°

- ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ëª©í‘œ, í™•ì¸í•  ì§€í‘œ: 2000ë…„ ì´í›„ì˜ ë©”ë‹¬ ìˆ˜ìƒ ê¸°ë¡ë§Œ ê³ ë ¤í–ˆì„ ë•Œ, ë©”ë‹¬ì„ ìˆ˜ìƒí•œ ì˜¬ë¦¼í”½ ì°¸ê°€ ì„ ìˆ˜ ì¤‘ __2ê°œ ì´ìƒì˜ êµ­ì ìœ¼ë¡œ ë©”ë‹¬ì„ ìˆ˜ìƒí•œ ê¸°ë¡ì´ ìˆëŠ” ì„ ìˆ˜ì˜ ì´ë¦„ ì¡°íšŒ__ í›„ __ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬__
- ì¿¼ë¦¬ ê³„ì‚° ë°©ë²•:   
    1. records, athletes, games í…Œì´ë¸” ì¡°ì¸ìœ¼ë¡œ ê²°í•©   
    2. WHEREì ˆ ì´ìš©í•´ì„œ 2000ë…„ ì´í›„ í•„í„°ë§   
    3. GROUP BYì ˆ ì´ìš©í•´ì„œ ì„ ìˆ˜ id ì´ìš©í•´ì„œ ê·¸ë£¹í•‘   
    4. HAVINGì ˆ ì´ìš©í•´ì„œ ê·¸ë£¹í•‘ ê²°ê³¼ ì¤‘ team_id ê³ ìœ ê°’ COUNTê°€ 2ê°œ ì´ìƒì¸ ê²°ê³¼ë§Œ í•„í„°ë§   
    5. ORDER BY ì´ìš©í•´ì„œ ì„ ìˆ˜ì´ë¦„ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬


- ë°ì´í„°ì˜ ê¸°ê°„: 2000ë…„ ì´í›„ ë©”ë‹¬ ìˆ˜ìƒ ê¸°ë¡
- ì‚¬ìš©í•  í…Œì´ë¸”: `records`, `athletes`, `games` 
- Join KEY: `r.athlete_id = a.id`, `r.game_id = g.id`
- ë°ì´í„° íŠ¹ì§•: í•œ ì„ ìˆ˜ê°€ __2ê°œ ì´ìƒì˜ êµ­ì __ ìœ¼ë¡œ ë©”ë‹¬ì„ ìˆ˜ìƒí•œ ê¸°ë¡ë“¤ì´ ì¡´ì¬í•¨

```sql
SELECT name
FROM records as r
JOIN athletes a 
ON r.athlete_id = a.id
JOIN games g 
ON r.game_id = g.id
WHERE medal IS NOT NULL AND year >= 2000
GROUP BY a.id
HAVING COUNT(DISTINCT team_id) >= 2
ORDER BY name
```

## ğŸ“Œ ì˜¨ë¼ì¸ ì‡¼í•‘ëª°ì˜ ì›” ë³„ ë§¤ì¶œì•¡ ì§‘ê³„


- ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ëª©í‘œ, í™•ì¸í•  ì§€í‘œ
    - ëª©í‘œ: UK E-Commerce Orders ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ __ì›”ë³„ ë§¤ì¶œ ê·œëª¨__ ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆëŠ” ë°ì´í„° ìƒì„±
    - í™•ì¸í•  ì§€í‘œ: `ordered_amount`: ì·¨ì†Œë˜ì§€ ì•Šì€ ì£¼ë¬¸ ê¸ˆì•¡ì˜ í•©ê³„, `canceled_amount`: ì·¨ì†Œ ì£¼ë¬¸ ê¸ˆì•¡ì˜ í•©ê³„ (ìŒìˆ˜ë¡œ í‘œê¸°), `total_amount`: ì·¨ì†Œ í¬í•¨ ì „ì²´ ì£¼ë¬¸ ê¸ˆì•¡ (ordered + canceled)
- ì¿¼ë¦¬ ê³„ì‚° ë°©ë²•:
    1. ì„œë¸Œì¿¼ë¦¬ í™œìš©í•˜ì—¬ ì·¨ì†Œ ì£¼ë¬¸ê³¼ ì¼ë°˜ ì£¼ë¬¸ì˜ ê¸ˆì•¡ ê°ê° ê³„ì‚°
    2. ë‘ ì„œë¸Œì¿¼ë¦¬ ê²°ê³¼ë¥¼ orders í…Œì´ë¸”ê³¼ LEFT JOIN
    3. strftime('%Y-%m', o.order_date) í†µí•´ order_month ìƒì„±, ì£¼ë¬¸ ìˆ˜ëŸ‰+ì·¨ì†Œ ìˆ˜ëŸ‰=ì´ ìˆ˜ëŸ‰ ê³„ì‚°
    4. order_month ê¸°ì¤€ìœ¼ë¡œ ê·¸ë£¹í•‘ í›„ ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
- ë°ì´í„°ì˜ ê¸°ê°„: ëª¨ë“  ê¸°ê°„
- ì‚¬ìš©í•  í…Œì´ë¸”: `orders`, `order_items`
- Join KEY: `orders.order_id = order_items.order_id`
- ë°ì´í„° íŠ¹ì§•: 
    1. ì·¨ì†Œ ì£¼ë¬¸ì€ order_idê°€ 'C%'ë¡œ ì‹œì‘
    2. ì·¨ì†Œ ì£¼ë¬¸ ê¸ˆì•¡ì€ ìŒìˆ˜ë¡œ í‘œê¸°

```sql
WITH canceled AS (SELECT i.order_id, SUM(i.price*i.quantity) AS canceled_amount
  FROM order_items i  
  JOIN orders o
  ON i.order_id = o.order_id
  WHERE i.order_id LIKE 'C%'
  GROUP BY i.order_id),

not_canceled AS (SELECT i.order_id, SUM(i.price*i.quantity) AS ordered_amount
  FROM order_items i  
  JOIN orders o
  ON i.order_id = o.order_id
  WHERE i.order_id NOT LIKE 'C%'
  GROUP BY i.order_id)

SELECT strftime('%Y-%m', o.order_date) AS order_month, SUM(n.ordered_amount) AS ordered_amount, SUM(c.canceled_amount) AS canceled_amount, SUM(n.ordered_amount) + SUM(c.canceled_amount) AS total_amount
FROM orders o
LEFT JOIN not_canceled n
ON n.order_id = o.order_id
LEFT JOIN canceled c
ON c.order_id = o.order_id
GROUP BY 1
ORDER BY 1
```




## ğŸ“Œ ì„¸ ëª…ì´ ì„œë¡œ ì¹œêµ¬ì¸ ê´€ê³„ ì°¾ê¸°

 - ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ëª©í‘œ, í™•ì¸í•  ì§€í‘œ: __IDê°€ 3820__ ì¸ ì‚¬ìš©ìë¥¼ í¬í•¨í•œ __3ëª…ì´ ì„œë¡œ ì¹œêµ¬ê´€ê³„ì¸ ê²½ìš°__ ë“¤ ì°¾ê¸°
- ì¿¼ë¦¬ ê³„ì‚° ë°©ë²•:
    1. UNOIN í™œìš©í•˜ì—¬ ì¹œêµ¬ê´€ê³„ ì–‘ë°©í–¥ í™•ì¥ 
    2. 3ë‹¨ JOIN í™œìš©í•˜ì—¬ ì‚¼ê°í˜• í˜•íƒœë¡œ ì¹œêµ¬ ê´€ê³„ í™•ì¸í•˜ê¸° 
    3. ê²°ê³¼ ì¤‘ `user_a_id < user_b_id < user_c_id` ì´ë©´ì„œ
`ID 3820`ì´ í¬í•¨ëœ ê²½ìš°ë§Œ í•„í„°ë§
- ë°ì´í„°ì˜ ê¸°ê°„: ëª¨ë“  ê¸°ê°„
- ì‚¬ìš©í•  í…Œì´ë¸”: `edges`
- Join KEY: `e1.user1 = e2.user1 AND e1.user2 < e2.user2`, `e3.user1 = e1.user2 AND e3.user2 = e2.user2`
- ë°ì´í„° íŠ¹ì§•: ID ìˆœì„œ í™œìš©í•˜ì—¬ ì¤‘ë³µ ì œê±° ê°€ëŠ¥, ì–‘ë°©í–¥ ê´€ê³„ê°€ ì•„ë‹˜
```sql
WITH A AS (
  SELECT user_a_id AS user1, user_b_id AS user2 FROM edges
  UNION
  SELECT user_b_id AS user1, user_a_id AS user2 FROM edges
)

SELECT 
  e1.user1 AS user_a_id,
  e1.user2 AS user_b_id,
  e2.user2 AS user_c_id
FROM A e1
JOIN A e2
  ON e1.user1 = e2.user1 AND e1.user2 < e2.user2
JOIN A e3
  ON e3.user1 = e1.user2 AND e3.user2 = e2.user2
WHERE 
  3820 IN (e1.user1, e1.user2, e2.user2)
  AND e1.user1 < e1.user2 AND e1.user2 < e2.user2;

```